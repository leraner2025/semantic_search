steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', '${_IMAGE_URI}', '.']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_IMAGE_URI}']

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'gcloud'
    args:
      [
        'run', 'deploy', '${_SERVICE_NAME}',
        '--image=${_IMAGE_URI}',
        '--region=${_REGION}',
        '--service-account=${_SERVICE_ACCOUNT}',
        '--vpc-connector=${_VPC_CONNECTOR}',
        '--no-allow-unauthenticated',
        '--set-env-vars=BUCKET_NAME=${_BUCKET_NAME},BQ_DATASET=${_BQ_DATASET},BQ_TABLE=${_BQ_TABLE},DOC_API_URL=${_DOC_API_URL}'

      ]
